# ALKOO Project Rules

このプロジェクトにおける開発・メンテナンスのルールです。AIは以下のルールに従って作業を行ってください。

## 1. Excelデータの更新と処理
- **データ変換**: `step_data.xlsx.xlsx` を更新した際は、必ず `node build-data.js` を実行して `data.js` を再生成する。
- **ログ確認**: `build-data.js` の実行結果ログを必ず確認する。「検出された日数」が正しいか（例: 12月なら31日分あるか）をチェックする。もし極端に少ない（例: 3日など）場合は、ヘッダーの解析ロジックに問題があるため、直ちに修正する。
- **生データの確認**: 解析トラブル時は、`XLSX.utils.sheet_to_json(worksheet, { header: 1 })` を使用して、Excelの生のヘッダー行を出力・確認する。列名が変更されている可能性がある。
- **数値の安全性**: Excelから読み込んだ数値は、カンマ区切りの文字列や空文字、`null` が含まれる可能性がある。常に安全な数値変換ロジック（`safe_float`的な処理）を使用する。

## 2. キャッシュ対策 (Cache Busting)
- **バージョン更新**: `data.js` や `app.js`、`styles.css` を変更した際は、必ず `index.html` 内の読み込みタグにあるクエリパラメータ（`?v=X`）をインクリメントする。
  - 例: `<script src="data.js?v=8"></script>` -> `<script src="data.js?v=9"></script>`
- これを行わないと、GitHub Pages上で古いデータが表示され続ける原因となる。

## 3. 動作確認
- **ローカルサーバー**: ローカルでの動作確認は `file://` プロトコルではなく、必ず簡易ローカルサーバーを使用する。
  - コマンド: `python -m http.server 8000`
  - URL: `http://localhost:8000`
- **GitHub Pages**: デプロイ後は、必ずスーパーリロード（`Ctrl + Shift + R` / `Cmd + Shift + R`）を行って確認するようユーザーに促す。

## 4. デザイン・UI
- **テーマ**: 現在のデザインテーマは「ALKOO with わんこ（暖色・丸み・アイボリー背景）」で固定されている。勝手にダークモードや別のスタイルに変更しない。
- **チーム色**: 統計情報のチーム名表示には、グラフと一致する色（北:青、南:赤）を使用する。

## 5. Git運用
- **Force Push**: リモートとの不整合が頻発しているため、確信がある場合のみ `git push -f origin main` を使用してもよいが、基本は `pull` して整合性を保つよう努める。

