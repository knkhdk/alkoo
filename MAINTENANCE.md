# 邦栄建設 コバトン健康マイレージ メンテナンス手順書

このドキュメントでは、歩数データの更新手順とトラブルシューティングについて説明します。

## ✅ 定期更新の手順

データの更新は以下の手順に従って行ってください。

### 1. Excelファイルの更新
新しい歩数データが含まれたExcelファイル（`step_data.xlsx.xlsx`）をプロジェクトのルートフォルダに上書き保存します。

### 2. データ変換の実行
ターミナル（PowerShellなど）を開き、以下のコマンドを実行します。

```powershell
node build-data.js
```

**⚠️ チェックポイント:**
コンソールの出力結果を確認し、特に最新月の日数が正しいか確認してください。
```
12月2025の日別データ: 10人, 31日  <-- ここが31日（または現在の日付まで）になっているか確認
```
もし「3日」など極端に少ない場合は、Excelの列名が読み取れていない可能性があります。

### 3. バージョン番号の更新（キャッシュ対策）
`index.html` を開き、`data.js` と `app.js` の読み込みタグにある `v=数字` を **1つ増やします**。
これを忘れると、GitHub Pages上で古いデータが表示され続けてしまいます。

```html
<!-- 変更前 -->
<script src="data.js?v=8"></script>
<script src="app.js?v=8"></script>

<!-- 変更後 -->
<script src="data.js?v=9"></script>
<script src="app.js?v=9"></script>
```

### 4. ローカルでの動作確認
以下のコマンドを実行し、ローカルサーバーを起動します。

```powershell
python -m http.server 8000
```

ブラウザで `http://localhost:8000` にアクセスし、グラフや表が正しく表示されているか確認します。

### 5. GitHubへの反映
確認が完了したら、変更をGitHubへアップロードします。

```powershell
git add .
git commit -m "12月データ更新 (v9)"
git push origin main
```

※ エラーが出る場合は `git pull` を試すか、どうしようもない場合のみ `git push -f origin main` を検討してください。

### 6. 本番環境の確認
数分後、 `https://knkhdk.github.io/alkoo/` にアクセスします。
**必ず「スーパーリロード（Ctrl + Shift + R）」を行って**、最新の状態であることを確認してください。

---

## 🔧 トラブルシューティング

### Q. データが数日分しか表示されない
**A. Excelの列名形式が変わった可能性があります。**
`build-data.js` はヘッダー行を自動解析しますが、特殊な文字や結合セルが含まれていると失敗することがあります。
`build-data.js` の実行ログに「警告」が出ていないか確認してください。

### Q. グラフが表示されない
**A. 数値データに「カンマ」や「文字」が混入している可能性があります。**
データ変換スクリプトは自動的にカンマを除去しますが、完全に不正な値（例: "欠席"など）が入っていると計算に失敗することがあります。

### Q. GitHub Pagesが更新されない
**A. ブラウザのキャッシュが原因の可能性が高いです。**
手順3のバージョン番号更新を忘れていないか確認し、ブラウザでスーパーリロードを行ってください。
また、GitHubの「Settings > Pages」でデプロイエラーが出ていないかも確認してください。

